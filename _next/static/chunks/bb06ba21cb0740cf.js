(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90153,88840,e=>{"use strict";e.i(47167);let t="".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean)[0]??"";function s(){return{url:"https://atdvzctfwjglsxctqwcy.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0ZHZ6Y3Rmd2pnbHN4Y3Rxd2N5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMTMzMDIsImV4cCI6MjA4MzU4OTMwMn0.K86GVTs3LH1NfaJMhxc3-9rnmlPCyoM8LWCpwgbJ8H8"}}e.s(["BARBER_EMAIL",0,t,"tryGetSupabaseEnv",()=>s],90153);var i=e.i(43476),r=e.i(932),n=e.i(71645),a=e.i(45060);function l(e){let t,s,l,o,c,d,m,u,x,b,h,g,p,f=(0,r.c)(32),{message:j,variant:v,onClose:N,autoHideMs:w,className:_}=e,k=void 0===v?"error":v,y=void 0===w?0:w,S=!!j;return(f[0]!==y||f[1]!==N||f[2]!==S?(t=()=>{if(!S||!N||!y)return;let e=window.setTimeout(N,y);return()=>window.clearTimeout(e)},s=[S,N,y],f[0]=y,f[1]=N,f[2]=S,f[3]=t,f[4]=s):(t=f[3],s=f[4]),(0,n.useEffect)(t,s),S)?(f[5]!==_||f[6]!==k?(m="success"===k?{border:"border-emerald-200",bg:"bg-emerald-50",text:"text-emerald-800",title:"Success"}:"warning"===k?{border:"border-[rgb(var(--warning))]/30",bg:"bg-[rgb(var(--warning-bg))]",text:"text-[rgb(var(--warning))]",title:"Notice"}:{border:"border-[rgb(var(--danger))]/30",bg:"bg-[rgb(var(--danger-bg))]",text:"text-[rgb(var(--danger))]",title:"Error"},f[12]!==_?(o=(0,a.cn)("pointer-events-none fixed inset-x-0 top-1/2 z-50 flex -translate-y-1/2 justify-center px-4",_),f[12]=_,f[13]=o):o=f[13],c="status",d="polite",l=(0,a.cn)("pointer-events-auto w-full max-w-md rounded-2xl border p-4 shadow-lg",m.border,m.bg,m.text),f[5]=_,f[6]=k,f[7]=l,f[8]=o,f[9]=c,f[10]=d,f[11]=m):(l=f[7],o=f[8],c=f[9],d=f[10],m=f[11]),f[14]!==m.title?(u=(0,i.jsx)("div",{className:"font-semibold",children:m.title}),f[14]=m.title,f[15]=u):u=f[15],f[16]!==N?(x=N?(0,i.jsx)("button",{type:"button",className:"rounded-lg px-2 py-1 text-sm font-semibold opacity-80 hover:opacity-100",onClick:N,"aria-label":"Dismiss message",children:"Close"}):null,f[16]=N,f[17]=x):x=f[17],f[18]!==u||f[19]!==x?(b=(0,i.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[u,x]}),f[18]=u,f[19]=x,f[20]=b):b=f[20],f[21]!==j?(h=(0,i.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-sm",children:j}),f[21]=j,f[22]=h):h=f[22],f[23]!==b||f[24]!==h||f[25]!==l?(g=(0,i.jsxs)("div",{className:l,role:"alert",children:[b,h]}),f[23]=b,f[24]=h,f[25]=l,f[26]=g):g=f[26],f[27]!==g||f[28]!==o||f[29]!==c||f[30]!==d?(p=(0,i.jsx)("div",{className:o,role:c,"aria-live":d,children:g}),f[27]=g,f[28]=o,f[29]=c,f[30]=d,f[31]=p):p=f[31],p):null}e.s(["Toast",()=>l],88840)},50649,e=>{"use strict";var t=e.i(43476),s=e.i(71645),i=e.i(2410),r=e.i(69212),n=e.i(88840);function a(e){let[a,l]=(0,s.useState)(e.bookingId),[o,c]=(0,s.useState)(e.token),d=(0,s.useMemo)(()=>(0,i.supabaseBrowser)(),[]),[m,u]=(0,s.useState)(null),[x,b]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0),[p,f]=(0,s.useState)(!1);async function j(){if(!d||!a||!o)return;f(!0),b(null);let e=await d.rpc("customer_check_in",{p_booking_id:a,p_customer_token:o});if(e.error){b(e.error.message),f(!1);return}fetch("/api/barber/notify",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({type:"checkin",bookingId:a})}).catch(()=>null);let t=await d.rpc("get_booking_for_customer",{p_booking_id:a,p_customer_token:o});u(t.data?.[0]??null),f(!1)}return(0,s.useEffect)(()=>{if(!a||!o)try{let e=new URLSearchParams(window.location.search),t=e.get("booking"),s=e.get("token");if(t&&s){l(t),c(s);return}let i=localStorage.getItem("nfs_last_booking"),r=i?JSON.parse(i):null;if(r?.booking_id&&r?.customer_token){l(r.booking_id),c(r.customer_token);return}if(t&&!s){let e=localStorage.getItem("nfs_booking_tokens"),s=e?JSON.parse(e):null,i=s?.[t]??null;i&&(l(t),c(i))}}catch{}},[]),(0,s.useEffect)(()=>{if(!d)return;let e=!0;return async function(t){if(g(!0),b(null),!a||!o){b("Missing booking link details. Please open the confirmation link from booking (it should include booking + token)."),g(!1);return}let s=await t.rpc("get_booking_for_customer",{p_booking_id:a,p_customer_token:o});if(e){if(s.error){b(s.error.message),g(!1);return}u(s.data?.[0]??null),g(!1)}}(d),()=>{e=!1}},[a,o,d]),(0,t.jsx)("div",{className:"min-h-screen px-4 py-5",children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-lg",children:[(0,t.jsxs)("header",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-[rgb(var(--muted))]",children:"Confirmation"}),(0,t.jsx)("h1",{className:"mt-1 text-2xl font-semibold tracking-tight",children:r.SHOP.name}),(0,t.jsx)("div",{className:"mt-2 text-sm text-[rgb(var(--muted))]",children:r.SHOP.address})]}),(0,t.jsxs)("section",{className:"card mt-4",children:[h?(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"Loading…"}):null,(0,t.jsx)(n.Toast,{message:x,onClose:()=>b(null)}),m?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"panel",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-white",children:"Date & time"}),(0,t.jsx)("span",{className:"font-semibold text-white",children:new Date(m.start_time).toLocaleString([],{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]}),(0,t.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-white",children:"Duration"}),(0,t.jsxs)("span",{className:"font-semibold text-white",children:[m.total_duration_minutes," min"]})]}),(0,t.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-white",children:"Total"}),(0,t.jsxs)("span",{className:"font-semibold  text-white",children:["₹",m.total_price_rupees]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Selected services"}),(0,t.jsx)("ul",{className:"mt-2 space-y-1 text-sm text-zinc-700",children:m.services.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{className:"text-[rgb(var(--muted))]",children:[e.duration_minutes," min · ₹",e.price_rupees]})]},s))})]}),(0,t.jsx)("div",{className:"rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3 text-sm",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-[rgb(var(--muted))]",children:"Status"}),(0,t.jsx)("span",{className:"font-semibold",children:m.status})]})}),(0,t.jsx)("button",{type:"button",onClick:j,disabled:p,className:"btn-primary ",children:p?"Checking in…":"I’ve arrived"}),(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:"Please arrive on time and check in at the shop."})]}):null]})]})})}e.s(["ConfirmClient",()=>a])}]);
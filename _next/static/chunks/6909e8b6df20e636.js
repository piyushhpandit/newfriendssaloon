(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90153,88840,e=>{"use strict";e.i(47167);let t="".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean)[0]??"";function s(){return{url:"https://atdvzctfwjglsxctqwcy.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0ZHZ6Y3Rmd2pnbHN4Y3Rxd2N5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMTMzMDIsImV4cCI6MjA4MzU4OTMwMn0.K86GVTs3LH1NfaJMhxc3-9rnmlPCyoM8LWCpwgbJ8H8"}}e.s(["BARBER_EMAIL",0,t,"tryGetSupabaseEnv",()=>s],90153);var r=e.i(43476),i=e.i(932),a=e.i(71645),n=e.i(45060);function l(e){let t,s,l,o,d,c,m,u,x,b,p,g,h,f=(0,i.c)(32),{message:v,variant:j,onClose:w,autoHideMs:N,className:y}=e,_=void 0===j?"error":j,I=void 0===N?0:N,C=!!v;return(f[0]!==I||f[1]!==w||f[2]!==C?(t=()=>{if(!C||!w||!I)return;let e=window.setTimeout(w,I);return()=>window.clearTimeout(e)},s=[C,w,I],f[0]=I,f[1]=w,f[2]=C,f[3]=t,f[4]=s):(t=f[3],s=f[4]),(0,a.useEffect)(t,s),C)?(f[5]!==y||f[6]!==_?(m="success"===_?{border:"border-emerald-200",bg:"bg-emerald-50",text:"text-emerald-800",title:"Success"}:"warning"===_?{border:"border-[rgb(var(--warning))]/30",bg:"bg-[rgb(var(--warning-bg))]",text:"text-[rgb(var(--warning))]",title:"Notice"}:{border:"border-[rgb(var(--danger))]/30",bg:"bg-[rgb(var(--danger-bg))]",text:"text-[rgb(var(--danger))]",title:"Error"},f[12]!==y?(o=(0,n.cn)("pointer-events-none fixed inset-x-0 top-1/2 z-50 flex -translate-y-1/2 justify-center px-4",y),f[12]=y,f[13]=o):o=f[13],d="status",c="polite",l=(0,n.cn)("pointer-events-auto w-full max-w-md rounded-2xl border p-4 shadow-lg",m.border,m.bg,m.text),f[5]=y,f[6]=_,f[7]=l,f[8]=o,f[9]=d,f[10]=c,f[11]=m):(l=f[7],o=f[8],d=f[9],c=f[10],m=f[11]),f[14]!==m.title?(u=(0,r.jsx)("div",{className:"font-semibold",children:m.title}),f[14]=m.title,f[15]=u):u=f[15],f[16]!==w?(x=w?(0,r.jsx)("button",{type:"button",className:"rounded-lg px-2 py-1 text-sm font-semibold opacity-80 hover:opacity-100",onClick:w,"aria-label":"Dismiss message",children:"Close"}):null,f[16]=w,f[17]=x):x=f[17],f[18]!==u||f[19]!==x?(b=(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[u,x]}),f[18]=u,f[19]=x,f[20]=b):b=f[20],f[21]!==v?(p=(0,r.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-sm",children:v}),f[21]=v,f[22]=p):p=f[22],f[23]!==b||f[24]!==p||f[25]!==l?(g=(0,r.jsxs)("div",{className:l,role:"alert",children:[b,p]}),f[23]=b,f[24]=p,f[25]=l,f[26]=g):g=f[26],f[27]!==g||f[28]!==o||f[29]!==d||f[30]!==c?(h=(0,r.jsx)("div",{className:o,role:d,"aria-live":c,children:g}),f[27]=g,f[28]=o,f[29]=d,f[30]=c,f[31]=h):h=f[31],h):null}e.s(["Toast",()=>l],88840)},45666,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(2410),i=e.i(69212),a=e.i(88840),n=e.i(18566);function l(e){return new Date(e).toLocaleString([],{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}function o(e){let{waitlistId:o,token:d}=e,c=(0,s.useMemo)(()=>(0,r.supabaseBrowser)(),[]),m=(0,n.useRouter)(),[u,x]=(0,s.useState)(null),[b,p]=(0,s.useState)(null),[g,h]=(0,s.useState)(!0),[f,v]=(0,s.useState)(!1);async function j(){if(p(null),!c){p("App is not ready. Please refresh."),h(!1);return}if(!o||!d){p("Missing waitlist link details."),h(!1);return}let e=await c.rpc("get_waitlist_for_customer",{p_waitlist_id:o,p_customer_token:d});if(e.error){p(e.error.message),h(!1);return}x(e.data?.[0]??null),h(!1)}async function w(){if(!c||!o||!d)return;v(!0),p(null);let e=await c.rpc("confirm_promotion",{p_waitlist_id:o,p_customer_token:d});if(e.error){p(e.error.message),v(!1);return}let t=e.data?.[0]??null;if(t?.booking_id){fetch("/api/barber/notify",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({type:"booking_confirmed",bookingId:t.booking_id})}).catch(()=>null),m.push(`/confirm?booking=${t.booking_id}&token=${d}`);return}v(!1),await j()}return(0,s.useEffect)(()=>{if(!c)return;j();let e=window.setInterval(()=>{j()},5e3);return()=>window.clearInterval(e)},[o,d,c]),(0,t.jsx)("div",{className:"min-h-screen px-4 py-5",children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-lg",children:[(0,t.jsxs)("header",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-[rgb(var(--muted))]",children:"Waitlist"}),(0,t.jsx)("h1",{className:"mt-1 text-2xl font-semibold tracking-tight",children:i.SHOP.name}),(0,t.jsx)("div",{className:"mt-2 text-sm text-[rgb(var(--muted))]",children:i.SHOP.address})]}),(0,t.jsxs)("section",{className:"card mt-4",children:[g?(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"Loading…"}):null,(0,t.jsx)(a.Toast,{message:b,onClose:()=>p(null)}),u?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"panel",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-[rgb(var(--muted))]",children:"Slot"}),(0,t.jsx)("span",{className:"font-semibold",children:l(u.slot_start_time)})]}),(0,t.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-[rgb(var(--muted))]",children:"Status"}),(0,t.jsx)("span",{className:"font-semibold",children:u.status})]})]}),"PROMOTED"===u.status?(0,t.jsxs)("div",{className:"rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3 text-sm",children:[(0,t.jsx)("div",{className:"font-semibold",children:"You’re up next"}),(0,t.jsxs)("div",{className:"mt-1 text-[rgb(var(--muted))]",children:["Confirm within 5 minutes to lock the slot.",u.promotion_expires_at?(0,t.jsxs)("div",{className:"mt-1",children:["Expires: ",(0,t.jsx)("span",{className:"font-medium",children:l(u.promotion_expires_at)})]}):null]})]}):null,"PROMOTED"===u.status?(0,t.jsx)("button",{type:"button",onClick:w,disabled:f,className:"btn-primary",children:f?"Confirming…":"Confirm slot"}):(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"Keep this page open. If a slot opens up, you’ll get 5 minutes to confirm."})]}):null]})]})})}e.s(["WaitlistClient",()=>o])}]);
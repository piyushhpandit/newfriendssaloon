(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90153,88840,e=>{"use strict";e.i(47167);let t="".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean)[0]??"";function s(){return{url:"https://atdvzctfwjglsxctqwcy.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0ZHZ6Y3Rmd2pnbHN4Y3Rxd2N5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMTMzMDIsImV4cCI6MjA4MzU4OTMwMn0.K86GVTs3LH1NfaJMhxc3-9rnmlPCyoM8LWCpwgbJ8H8"}}e.s(["BARBER_EMAIL",0,t,"tryGetSupabaseEnv",()=>s],90153);var r=e.i(43476),a=e.i(932),i=e.i(71645),n=e.i(45060);function l(e){let t,s,l,o,d,c,m,u,x,g,b,f,h,p=(0,a.c)(32),{message:v,variant:j,onClose:N,autoHideMs:w,className:y}=e,_=void 0===j?"error":j,S=void 0===w?0:w,k=!!v;return(p[0]!==S||p[1]!==N||p[2]!==k?(t=()=>{if(!k||!N||!S)return;let e=window.setTimeout(N,S);return()=>window.clearTimeout(e)},s=[k,N,S],p[0]=S,p[1]=N,p[2]=k,p[3]=t,p[4]=s):(t=p[3],s=p[4]),(0,i.useEffect)(t,s),k)?(p[5]!==y||p[6]!==_?(m="success"===_?{border:"border-emerald-200",bg:"bg-emerald-50",text:"text-emerald-800",title:"Success"}:"warning"===_?{border:"border-[rgb(var(--warning))]/30",bg:"bg-[rgb(var(--warning-bg))]",text:"text-[rgb(var(--warning))]",title:"Notice"}:{border:"border-[rgb(var(--danger))]/30",bg:"bg-[rgb(var(--danger-bg))]",text:"text-[rgb(var(--danger))]",title:"Error"},p[12]!==y?(o=(0,n.cn)("pointer-events-none fixed inset-x-0 top-1/2 z-50 flex -translate-y-1/2 justify-center px-4",y),p[12]=y,p[13]=o):o=p[13],d="status",c="polite",l=(0,n.cn)("pointer-events-auto w-full max-w-md rounded-2xl border p-4 shadow-lg",m.border,m.bg,m.text),p[5]=y,p[6]=_,p[7]=l,p[8]=o,p[9]=d,p[10]=c,p[11]=m):(l=p[7],o=p[8],d=p[9],c=p[10],m=p[11]),p[14]!==m.title?(u=(0,r.jsx)("div",{className:"font-semibold",children:m.title}),p[14]=m.title,p[15]=u):u=p[15],p[16]!==N?(x=N?(0,r.jsx)("button",{type:"button",className:"rounded-lg px-2 py-1 text-sm font-semibold opacity-80 hover:opacity-100",onClick:N,"aria-label":"Dismiss message",children:"Close"}):null,p[16]=N,p[17]=x):x=p[17],p[18]!==u||p[19]!==x?(g=(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[u,x]}),p[18]=u,p[19]=x,p[20]=g):g=p[20],p[21]!==v?(b=(0,r.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-sm",children:v}),p[21]=v,p[22]=b):b=p[22],p[23]!==g||p[24]!==b||p[25]!==l?(f=(0,r.jsxs)("div",{className:l,role:"alert",children:[g,b]}),p[23]=g,p[24]=b,p[25]=l,p[26]=f):f=p[26],p[27]!==f||p[28]!==o||p[29]!==d||p[30]!==c?(h=(0,r.jsx)("div",{className:o,role:d,"aria-live":c,children:f}),p[27]=f,p[28]=o,p[29]=d,p[30]=c,p[31]=h):h=p[31],h):null}e.s(["Toast",()=>l],88840)},52683,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(69212),a=e.i(2410);function i(e,t){let[s,r]=t.split(":").map(e=>Number(e));return new Date(e.getFullYear(),e.getMonth(),e.getDate(),s,r,0,0)}function n(e,t){return e.start<t.end&&t.start<e.end}var l=e.i(18566),o=e.i(88840);function d(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function c(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)}function m(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${r}`}function u(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function x(){let e=(0,l.useRouter)(),x=(0,s.useMemo)(()=>(0,a.supabaseBrowser)(),[]),[g,b]=(0,s.useState)(()=>c(new Date)),[f,h]=(0,s.useState)([]),[p,v]=(0,s.useState)({}),[j,N]=(0,s.useState)([]),[w,y]=(0,s.useState)(null),[_,S]=(0,s.useState)(null),[k,D]=(0,s.useState)(""),[T,E]=(0,s.useState)(""),[O,I]=(0,s.useState)(!0),[M,C]=(0,s.useState)(null),[P,A]=(0,s.useState)("services"),B=(0,s.useMemo)(()=>f.filter(e=>p[e.id]),[f,p]),L=B.length>0,Y=!!_;(0,s.useEffect)(()=>{L||"services"===P||A("services")},[L,P]),(0,s.useEffect)(()=>{"services"===P&&L&&A("slots")},[P,L]),(0,s.useEffect)(()=>{"details"===P&&L&&!Y&&A("slots"),"slots"===P&&L&&Y&&A("details")},[P,L,Y]);let R=(0,s.useMemo)(()=>({totalDuration:B.reduce((e,t)=>e+t.duration_minutes,0),totalPrice:B.reduce((e,t)=>e+t.price_rupees,0)}),[B]);async function J(){if(C(null),!x)return C("App is not ready. Please refresh.");if(!_)return C("Select a time slot.");if(_.start.getTime()<Date.now()+6e4)return C("You can’t book a slot in the past.");if(_.start.getTime()>Date.now()+6048e5)return C("You can only book up to 7 days in advance.");if(!k.trim())return C("Enter your name.");if(!T.trim())return C("Enter your phone number.");if(0===B.length)return C("Select at least one service.");let t=await x.rpc("create_booking",{p_customer_name:k.trim(),p_customer_phone:T.trim(),p_start_time:_.start.toISOString(),p_service_ids:B.map(e=>e.id)});if(t.error)return C(t.error.message);let s=t.data?.[0]??null;if(!s)return C("Booking failed. Please try again.");try{localStorage.setItem("nfs_last_booking",JSON.stringify({booking_id:s.booking_id,customer_token:s.customer_token,at:Date.now()}));let e=localStorage.getItem("nfs_booking_tokens"),t=e?JSON.parse(e):{};t[s.booking_id]=s.customer_token,localStorage.setItem("nfs_booking_tokens",JSON.stringify(t))}catch{}fetch("/api/barber/notify",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({type:"booking_confirmed",bookingId:s.booking_id})}).catch(()=>null),e.push(`/confirm?booking=${s.booking_id}&token=${s.customer_token}`)}async function H(t){if(C(null),!x)return C("App is not ready. Please refresh.");if(t.getTime()<Date.now()+6e4)return C("You can’t join a waitlist for a past slot.");if(t.getTime()>Date.now()+6048e5)return C("You can only join waitlist up to 7 days in advance.");if(!k.trim())return C("Enter your name.");if(!T.trim())return C("Enter your phone number.");if(0===B.length)return C("Select at least one service.");let s=await x.rpc("join_waitlist",{p_slot_start_time:t.toISOString(),p_customer_name:k.trim(),p_customer_phone:T.trim(),p_service_ids:B.map(e=>e.id)});if(s.error)return C(s.error.message);let r=s.data?.[0]??null;if(!r)return C("Could not join waitlist. Please try again.");e.push(`/waitlist?waitlist=${r.waitlist_id}&token=${r.customer_token}`)}return(0,s.useEffect)(()=>{if(!x)return;let e=!0;return async function(t){I(!0),C(null),S(null);let s=g.getDay(),a=c(g),l=new Date(g.getFullYear(),g.getMonth(),g.getDate(),23,59,59,999);await t.rpc("maintenance_tick");let[o,d,m,x]=await Promise.all([t.from("services").select("id,name,price_rupees,duration_minutes").order("name"),t.from("availability_rules").select("is_day_off,work_start,work_end,break_start,break_end").eq("day_of_week",s).maybeSingle(),t.from("blocked_slots").select("start_time,end_time").lt("start_time",l.toISOString()).gt("end_time",a.toISOString()),t.rpc("get_busy_intervals",{p_start:a.toISOString(),p_end:l.toISOString()})]);if(!e)return;if(o.error)return C(o.error.message);if(d.error)return C(d.error.message);if(m.error)return C(m.error.message);if(x.error)return C(x.error.message);h(o.data??[]);let f=d.data??null,p=c(new Date);if(a.getTime()===p.getTime()&&f&&!f.is_day_off){let e=function(e,t){let[s,r]=t.split(":").map(e=>Number(e));return new Date(e.getFullYear(),e.getMonth(),e.getDate(),s,r||0,0,0)}(g,f.work_end);if(Date.now()>e.getTime()){let e=c(u(new Date,1)),t=c(u(new Date,7));if(e.getTime()<=t.getTime()){b(e),I(!1);return}}}let v=(m.data??[]).map(e=>({start:new Date(e.start_time),end:new Date(e.end_time)})),j=function(e){let t=e.stepMinutes??r.SHOP.slotStepMinutes,s=e.bufferMinutes??r.SHOP.bufferMinutes;if(!e.rule||e.rule.is_day_off)return{slots:[],nextAvailable:null};let a=i(e.day,e.rule.work_start),l=i(e.day,e.rule.work_end),o=e.rule.break_start&&e.rule.break_end?{start:i(e.day,e.rule.break_start),end:i(e.day,e.rule.break_end)}:null,d=[];for(let r=new Date(a);r.getTime()+6e4*e.durationMinutes<=l.getTime();r=new Date(r.getTime()+6e4*t)){let t={start:r,end:new Date(r.getTime()+6e4*e.durationMinutes)},a={start:t.start,end:new Date(t.end.getTime()+6e4*s)};if(o&&n(t,o)||e.blocked.some(e=>n(t,e))){d.push({start:t.start,end:t.end,state:"BLOCKED"});continue}let i=e.busy.some(e=>n(a,e));d.push({start:t.start,end:t.end,state:i?"BOOKED":"AVAILABLE"})}let c=d.find(e=>"AVAILABLE"===e.state)??null;return{slots:d,nextAvailable:c}}({day:g,rule:f,blocked:v,busy:(x.data??[]).map(e=>({start:new Date(e.start_time),end:new Date(e.end_time)})),durationMinutes:R.totalDuration>0?R.totalDuration:30}),w=c(g).getTime()===c(new Date).getTime()?Date.now()+6e4:-1/0,_=j.slots.map(e=>e.start.getTime()<w?{...e,state:"BLOCKED"}:e);N(_),y(_.find(e=>"AVAILABLE"===e.state)??null),I(!1)}(x),()=>{e=!1}},[x,R.totalDuration,g]),(0,t.jsx)("div",{className:"min-h-screen px-4 py-5",children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-lg",children:[x?null:(0,t.jsxs)("div",{className:"alert-warning mb-4",children:[(0,t.jsx)("div",{className:"font-semibold text-[rgb(var(--warning))]",children:"Setup required"}),(0,t.jsxs)("div",{className:"mt-1",children:["Add ",(0,t.jsx)("span",{className:"font-mono",children:"NEXT_PUBLIC_SUPABASE_URL"})," and"," ",(0,t.jsx)("span",{className:"font-mono",children:"NEXT_PUBLIC_SUPABASE_ANON_KEY"})," to"," ",(0,t.jsx)("span",{className:"font-mono",children:".env.local"}),", then restart the dev server."]})]}),(0,t.jsxs)("header",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-[rgb(var(--muted))]",children:"Booking"}),(0,t.jsx)("h1",{className:"mt-1 text-2xl font-semibold tracking-tight",children:r.SHOP.name}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-[rgb(var(--muted))]",children:[(0,t.jsx)("div",{children:r.SHOP.address}),(0,t.jsxs)("div",{className:"mt-1",children:["Call:"," ",(0,t.jsx)("a",{className:"font-medium underline",href:`tel:${r.SHOP.phone}`,children:r.SHOP.phone})]})]})]}),(0,t.jsxs)("section",{className:"card mt-4",children:[(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between gap-3 text-left",onClick:()=>A("services"),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-base font-semibold",children:"1) Services"}),(0,t.jsx)("div",{className:"mt-0.5 text-xs text-[rgb(var(--muted))]",children:L?`${B.length} selected`:"Select at least 1 service"})]}),(0,t.jsx)("div",{className:"text-xs font-semibold text-[rgb(var(--muted))]",children:"services"===P?"OPEN":L?"DONE":"REQUIRED"})]}),"services"===P?(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[f.map(e=>(0,t.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3",children:[(0,t.jsx)("input",{type:"checkbox",className:"mt-1 h-5 w-5",checked:!!p[e.id],onChange:t=>v(s=>({...s,[e.id]:t.target.checked}))}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-[rgb(var(--muted))]",children:["₹",e.price_rupees]})]}),(0,t.jsxs)("div",{className:"text-sm text-[rgb(var(--muted))]",children:[e.duration_minutes," min"]})]})]},e.id)),0===f.length&&(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"no active services yet."})]}),(0,t.jsxs)("div",{className:"input mt-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-[rgb(var(--text))]",children:"Total duration"}),(0,t.jsxs)("span",{className:"font-medium",children:[R.totalDuration||0," min"]})]}),(0,t.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-[rgb(var(--muted))]",children:"Total Price"}),(0,t.jsxs)("span",{className:"font-medium",children:["₹",R.totalPrice||0]})]})]})]}):null]}),(0,t.jsxs)("section",{className:"card mt-4",children:[(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between gap-3 text-left disabled:opacity-60",onClick:()=>A("slots"),disabled:!L,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-base font-semibold",children:"2) Time slot"}),(0,t.jsx)("div",{className:"mt-0.5 text-xs text-[rgb(var(--muted))]",children:L?_?`Selected: ${d(_.start)}`:"Pick a date & time":"Select services first"})]}),(0,t.jsx)("div",{className:"text-xs font-semibold text-[rgb(var(--muted))]",children:"slots"===P?"OPEN":Y?"DONE":"REQUIRED"})]}),"slots"===P&&L?(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:w?(0,t.jsxs)(t.Fragment,{children:["Next: ",(0,t.jsx)("span",{className:"font-semibold",children:d(w.start)})]}):"No slots"})}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Date (next 7 days)"}),(0,t.jsx)("input",{className:"input mt-1",type:"date",value:m(g),min:m(c(new Date)),max:m(c(u(new Date,7))),onChange:e=>{let t=function(e){let[t,s,r]=e.split("-").map(e=>Number(e));return t&&s&&r?new Date(t,s-1,r,0,0,0,0):null}(e.target.value);if(!t)return;let s=c(new Date),r=c(u(new Date,7));b(t.getTime()<s.getTime()?s:t.getTime()>r.getTime()?r:t)}})]})}),O?(0,t.jsx)("div",{className:"mt-3 text-sm text-[rgb(var(--muted))]",children:"Loading…"}):(0,t.jsx)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:j.map(e=>{let s=_?.start.getTime()===e.start.getTime();return"BLOCKED"===e.state?(0,t.jsx)("div",{className:"rounded-xl border border-dashed border-[rgb(var(--border))] bg-[rgb(var(--card))] px-3 py-3 text-center text-sm text-[rgb(var(--placeholder))]",children:d(e.start)},e.start.toISOString()):"BOOKED"===e.state?(0,t.jsxs)("button",{type:"button",onClick:()=>H(e.start),className:"rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--bg))] px-3 py-3 text-left text-white",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:d(e.start)}),(0,t.jsxs)("div",{className:"mt-0.5 text-xs font-medium text-white",children:["Booked · ",(0,t.jsx)("span",{className:"text-white",children:"Join waitlist"})]})]},e.start.toISOString()):(0,t.jsxs)("button",{type:"button",onClick:()=>S(e),className:["rounded-xl border px-3 py-3 text-left",s?"border-[rgb(var(--primary))] bg-[rgb(var(--primary))] text-[rgb(var(--primary-foreground))]":"border-[rgb(var(--border))] bg-[rgb(var(--card))]"].join(" "),children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:d(e.start)}),(0,t.jsx)("div",{className:s?"mt-0.5 text-xs text-[rgb(var(--primary-foreground))]/80":"mt-0.5 text-xs text-[rgb(var(--muted))]",children:"Available"})]},e.start.toISOString())})})]}):null]}),(0,t.jsxs)("section",{className:"card mt-4",children:[(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between gap-3 text-left disabled:opacity-60",onClick:()=>A("details"),disabled:!L||!Y,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-base font-semibold",children:"3) Your details"}),(0,t.jsx)("div",{className:"mt-0.5 text-xs text-[rgb(var(--muted))]",children:L?Y?"Enter your name & phone":"Choose a time slot first":"Select services first"})]}),(0,t.jsx)("div",{className:"text-xs font-semibold text-[rgb(var(--muted))]",children:"details"===P?"OPEN":k.trim()&&T.trim()?"READY":"REQUIRED"})]}),"details"===P&&L&&Y?(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Name"}),(0,t.jsx)("input",{className:"input mt-1",value:k,onChange:e=>D(e.target.value),placeholder:"Your name"})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Phone number"}),(0,t.jsx)("input",{className:"input mt-1",value:T,onChange:e=>E(e.target.value),inputMode:"tel",placeholder:"10-digit mobile"})]}),(0,t.jsx)(o.Toast,{message:M,onClose:()=>C(null)}),(0,t.jsx)("button",{type:"button",onClick:J,className:"btn-primary mt-1",children:"Book selected time"}),(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:"Please arrive on time and check in at the shop."})]}):null]}),(0,t.jsx)("footer",{className:"mt-6 pb-6 text-center text-xs text-[rgb(var(--muted))]",children:"This booking system was built by a local developer. Want one for your business? Ask inside."})]})})}e.s(["default",()=>x],52683)}]);
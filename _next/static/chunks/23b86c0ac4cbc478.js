(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90153,88840,e=>{"use strict";e.i(47167);let t="".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean)[0]??"";function a(){return{url:"https://atdvzctfwjglsxctqwcy.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0ZHZ6Y3Rmd2pnbHN4Y3Rxd2N5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMTMzMDIsImV4cCI6MjA4MzU4OTMwMn0.K86GVTs3LH1NfaJMhxc3-9rnmlPCyoM8LWCpwgbJ8H8"}}e.s(["BARBER_EMAIL",0,t,"tryGetSupabaseEnv",()=>a],90153);var s=e.i(43476),r=e.i(932),i=e.i(71645),n=e.i(45060);function l(e){let t,a,l,c,d,o,u,m,b,x,h,g,_,p=(0,r.c)(32),{message:v,variant:f,onClose:N,autoHideMs:w,className:y}=e,j=void 0===f?"error":f,k=void 0===w?0:w,C=!!v;return(p[0]!==k||p[1]!==N||p[2]!==C?(t=()=>{if(!C||!N||!k)return;let e=window.setTimeout(N,k);return()=>window.clearTimeout(e)},a=[C,N,k],p[0]=k,p[1]=N,p[2]=C,p[3]=t,p[4]=a):(t=p[3],a=p[4]),(0,i.useEffect)(t,a),C)?(p[5]!==y||p[6]!==j?(u="success"===j?{border:"border-emerald-200",bg:"bg-emerald-50",text:"text-emerald-800",title:"Success"}:"warning"===j?{border:"border-[rgb(var(--warning))]/30",bg:"bg-[rgb(var(--warning-bg))]",text:"text-[rgb(var(--warning))]",title:"Notice"}:{border:"border-[rgb(var(--danger))]/30",bg:"bg-[rgb(var(--danger-bg))]",text:"text-[rgb(var(--danger))]",title:"Error"},p[12]!==y?(c=(0,n.cn)("pointer-events-none fixed inset-x-0 top-1/2 z-50 flex -translate-y-1/2 justify-center px-4",y),p[12]=y,p[13]=c):c=p[13],d="status",o="polite",l=(0,n.cn)("pointer-events-auto w-full max-w-md rounded-2xl border p-4 shadow-lg",u.border,u.bg,u.text),p[5]=y,p[6]=j,p[7]=l,p[8]=c,p[9]=d,p[10]=o,p[11]=u):(l=p[7],c=p[8],d=p[9],o=p[10],u=p[11]),p[14]!==u.title?(m=(0,s.jsx)("div",{className:"font-semibold",children:u.title}),p[14]=u.title,p[15]=m):m=p[15],p[16]!==N?(b=N?(0,s.jsx)("button",{type:"button",className:"rounded-lg px-2 py-1 text-sm font-semibold opacity-80 hover:opacity-100",onClick:N,"aria-label":"Dismiss message",children:"Close"}):null,p[16]=N,p[17]=b):b=p[17],p[18]!==m||p[19]!==b?(x=(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[m,b]}),p[18]=m,p[19]=b,p[20]=x):x=p[20],p[21]!==v?(h=(0,s.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-sm",children:v}),p[21]=v,p[22]=h):h=p[22],p[23]!==x||p[24]!==h||p[25]!==l?(g=(0,s.jsxs)("div",{className:l,role:"alert",children:[x,h]}),p[23]=x,p[24]=h,p[25]=l,p[26]=g):g=p[26],p[27]!==g||p[28]!==c||p[29]!==d||p[30]!==o?(_=(0,s.jsx)("div",{className:c,role:d,"aria-live":o,children:g}),p[27]=g,p[28]=c,p[29]=d,p[30]=o,p[31]=_):_=p[31],_):null}e.s(["Toast",()=>l],88840)},89283,e=>{"use strict";var t=e.i(43476),a=e.i(932),s=e.i(71645),r=e.i(2410),i=e.i(18566),n=e.i(69212),l=e.i(88840);function c(e){return new Date(e).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function d(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)}function o(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}function u(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${s}`}function m(e){let t=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e);if(!t)return null;let a=new Date(Number(t[1]),Number(t[2])-1,Number(t[3]),0,0,0,0);return Number.isNaN(a.getTime())?null:a}function b(e,t){let a=/^(\d{2}):(\d{2})$/.exec(t);if(!a)return null;let s=Number(a[1]),r=Number(a[2]),i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),s,r,0,0);return Number.isNaN(i.getTime())?null:i}let x={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"},h=[{day_of_week:0,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"},{day_of_week:1,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"},{day_of_week:2,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"},{day_of_week:3,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"},{day_of_week:4,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"},{day_of_week:5,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"},{day_of_week:6,is_day_off:!1,work_start:"10:00",work_end:"20:00",break_start:"14:00",break_end:"15:00"}];function g(e){let s,r=(0,a.c)(4),i=e.active?"rounded-xl bg-[rgb(var(--primary))] px-3 py-2 text-sm font-semibold text-[rgb(var(--primary-foreground))]":"rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] px-3 py-2 text-sm font-semibold text-[rgb(var(--text))]";return r[0]!==e.children||r[1]!==e.onClick||r[2]!==i?(s=(0,t.jsx)("button",{type:"button",onClick:e.onClick,className:i,children:e.children}),r[0]=e.children,r[1]=e.onClick,r[2]=i,r[3]=s):s=r[3],s}function _(){let e=(0,s.useMemo)(()=>(0,r.supabaseBrowser)(),[]),a=(0,i.useRouter)(),_=(0,i.useSearchParams)(),[p,v]=(0,s.useState)(null),f=_.get("tab")??null,N=f&&["bookings","queue","slots","services"].includes(f)?f:"bookings",[w,y]=(0,s.useState)(null),[j,k]=(0,s.useState)(!0),[C,S]=(0,s.useState)("today"),[E,D]=(0,s.useState)(u(new Date)),[O,I]=(0,s.useState)(u(new Date)),[L,T]=(0,s.useState)(u(new Date)),[A,M]=(0,s.useState)("ALL"),[R,H]=(0,s.useState)(""),[P,z]=(0,s.useState)([]),[B,W]=(0,s.useState)(u(new Date)),[K,q]=(0,s.useState)(!0),[F,Y]=(0,s.useState)([]),[J,V]=(0,s.useState)([]),[$,U]=(0,s.useState)(!1),[X,G]=(0,s.useState)(u(new Date)),[Z,Q]=(0,s.useState)([]),[ee,et]=(0,s.useState)("10:00"),[ea,es]=(0,s.useState)("20:00"),[er,ei]=(0,s.useState)(""),[en,el]=(0,s.useState)(!1),[ec,ed]=(0,s.useState)([]),[eo,eu]=(0,s.useState)(null),[em,eb]=(0,s.useState)({name:"",price:"",duration:""});function ex(e){let t=new URLSearchParams(_.toString());t.set("tab",e),a.replace(`/barber?${t.toString()}`)}async function eh(){if(!e)return null;let{data:t}=await e.auth.getSession();if(!t.session)return null;let{data:a,error:s}=await e.rpc("is_barber");return s?(y(s.message),null):a?e:(y("Access denied. This account is not allowed to use the barber dashboard."),await e.auth.signOut(),null)}async function eg(e){await e.rpc("maintenance_tick")}async function e_(e){k(!0),y(null),await eg(e);let t=null,a=null;if("today"===C){let e=m(E)??new Date;t=d(e),a=o(e)}else{let e=m(O),s=m(L);e&&s&&(t=d(e),a=o(s))}if(!t||!a){y("Pick a valid date range."),k(!1);return}let s=e.from("bookings").select("id,start_time,end_time,customer_name,customer_phone,status,created_at").gte("start_time",t.toISOString()).lt("start_time",a.toISOString()).order("start_time",{ascending:!0});"ALL"!==A&&(s=s.eq("status",A));let r=await s;if(r.error){y(r.error.message),k(!1);return}let i=r.data??[],n=R.trim().toLowerCase();z(0===n.length?i:i.filter(e=>{let t=(e.customer_name??"").toLowerCase(),a=(e.customer_phone??"").toLowerCase();return t.includes(n)||a.includes(n)})),k(!1)}async function ep(t,a){if(y(null),!e)return;let s=await e.from("bookings").update({status:a}).eq("id",t).select("start_time").maybeSingle();if(s.error)return void y(s.error.message);if(("CANCELLED"===a||"CHECKED_IN"===a)&&fetch("/api/barber/notify",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({type:"CHECKED_IN"===a?"checkin":"cancelled",bookingId:t})}).catch(()=>null),("CANCELLED"===a||"NO_SHOW"===a)&&s.data?.start_time){let t=new Date(s.data.start_time).getTime();Number.isFinite(t)&&t>Date.now()&&await e.rpc("promote_waitlist_for_slot",{p_slot_start_time:s.data.start_time})}let r=await eh();r&&await e_(r)}async function ev(){e&&(await e.auth.signOut(),a.push("/barber/login"))}async function ef(e){k(!0),y(null),await eg(e);let t=m(B)??new Date,a=d(t),s=o(t),r=e.from("waitlist").select("id,slot_start_time,customer_name,customer_phone,status,total_duration_minutes,total_price_rupees,created_at,promoted_at,promotion_expires_at,booking_id").gte("slot_start_time",a.toISOString()).lt("slot_start_time",s.toISOString()).order("slot_start_time",{ascending:!0}).order("created_at",{ascending:!0});K&&(r=r.in("status",["WAITING","PROMOTED"]));let i=await r;if(i.error){y(i.error.message),k(!1);return}Y(i.data??[]),k(!1)}async function eN(e,t){y(null);let a=await e.rpc("promote_waitlist_for_slot",{p_slot_start_time:t});a.error?y(a.error.message):(await ef(e),await e_(e))}async function ew(e,t){y(null);let a=await e.from("waitlist").update({status:"CANCELLED"}).eq("id",t);a.error?y(a.error.message):await ef(e)}async function ey(e){k(!0),y(null);let t=await e.from("availability_rules").select("day_of_week,is_day_off,work_start,work_end,break_start,break_end").order("day_of_week",{ascending:!0});if(t.error){y(t.error.message),k(!1);return}V(t.data??[]),k(!1)}async function ej(e){y(null),U(!0);let t=h.map(e=>({day_of_week:e.day_of_week,is_day_off:e.is_day_off,work_start:e.work_start,work_end:e.work_end,break_start:e.break_start,break_end:e.break_end})),a=await e.from("availability_rules").upsert(t,{onConflict:"day_of_week"});if(a.error){y(a.error.message),U(!1);return}U(!1),await ey(e)}async function ek(e){if(y(null),U(!0),0===J.length){y("No schedule rows found. Click “Initialize default schedule” first."),U(!1);return}let t=J.map(e=>({day_of_week:e.day_of_week,is_day_off:e.is_day_off,work_start:e.work_start,work_end:e.work_end,break_start:e.break_start,break_end:e.break_end})),a=await e.from("availability_rules").upsert(t,{onConflict:"day_of_week"});if(a.error){y(a.error.message),U(!1);return}U(!1),await ey(e)}async function eC(e){k(!0),y(null);let t=m(X)??new Date,a=d(t),s=o(t),r=await e.from("blocked_slots").select("id,start_time,end_time,reason").lt("start_time",s.toISOString()).gt("end_time",a.toISOString()).order("start_time",{ascending:!0});if(r.error){y(r.error.message),k(!1);return}Q(r.data??[]),k(!1)}async function eS(e){y(null),el(!0);let t=m(X)??new Date,a=b(t,ee),s=b(t,ea);if(!a||!s||a>=s){y("Choose a valid block start/end time."),el(!1);return}let r=await e.from("blocked_slots").insert({start_time:a.toISOString(),end_time:s.toISOString(),reason:er.trim()||null});if(r.error){y(r.error.message),el(!1);return}el(!1),await eC(e)}async function eE(e,t){y(null);let a=await e.from("blocked_slots").delete().eq("id",t);a.error?y(a.error.message):await eC(e)}async function eD(e){y(null),el(!0);let t=new Date,a=t.getDay(),s=J.find(e=>e.day_of_week===a)??null,r=d(t),i=s?.work_start?.slice(0,5)??"10:00",n=s?.work_end?.slice(0,5)??"20:00",l=b(r,i),c=b(r,n);if(!l||!c||l>=c){y("Could not compute today’s work hours. Check availability rules."),el(!1);return}let o=await e.from("blocked_slots").insert({start_time:l.toISOString(),end_time:c.toISOString(),reason:"CLOSED_TODAY"});if(o.error){y(o.error.message),el(!1);return}el(!1),G(u(new Date)),await eC(e)}async function eO(e){y(null),el(!0);let t=new Date,a=d(t),s=o(t),r=await e.from("blocked_slots").delete().eq("reason","CLOSED_TODAY").gte("start_time",a.toISOString()).lt("start_time",s.toISOString());if(r.error){y(r.error.message),el(!1);return}el(!1),G(u(new Date)),await eC(e)}async function eI(e){k(!0),y(null);let t=await e.from("services").select("id,name,price_rupees,duration_minutes,is_active").order("name",{ascending:!0});if(t.error){y(t.error.message),k(!1);return}ed(t.data??[]),k(!1)}async function eL(e,t){y(null),eu(t.id);let a=await e.from("services").update({is_active:!t.is_active}).eq("id",t.id);if(a.error){y(a.error.message),eu(null);return}eu(null),await eI(e)}async function eT(e){y(null);let t=em.name.trim(),a=Number(em.price),s=Number(em.duration);if(!t)return y("Service name is required.");if(!Number.isFinite(a)||a<0)return y("Enter a valid price.");if(!Number.isFinite(s)||s<=0)return y("Enter a valid duration (minutes).");eu("NEW");let r=await e.from("services").insert({name:t,price_rupees:a,duration_minutes:s,is_active:!0});if(r.error){y(r.error.message),eu(null);return}eb({name:"",price:"",duration:""}),eu(null),await eI(e)}return((0,s.useEffect)(()=>{(async()=>{let e=await eh();if(!e){v(!1),k(!1);return}v(!0),"bookings"===N?await e_(e):"queue"===N?await ef(e):"slots"===N?await Promise.all([ey(e),eC(e)]):"services"===N&&await eI(e)})()},[N]),!1===p)?(a.replace("/barber/login"),null):(0,t.jsx)("div",{className:"min-h-screen px-4 py-5",children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-lg",children:[(0,t.jsx)("header",{className:"card",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-[rgb(var(--muted))]",children:"Barber Dashboard"}),(0,t.jsx)("h1",{className:"mt-1 text-2xl font-semibold tracking-tight",children:n.SHOP.name}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,t.jsx)(g,{active:"bookings"===N,onClick:()=>ex("bookings"),children:"Bookings"}),(0,t.jsx)(g,{active:"queue"===N,onClick:()=>ex("queue"),children:"Queue"}),(0,t.jsx)(g,{active:"slots"===N,onClick:()=>ex("slots"),children:"Slots"}),(0,t.jsx)(g,{active:"services"===N,onClick:()=>ex("services"),children:"Services"})]})]}),(0,t.jsx)("button",{type:"button",onClick:ev,className:"btn-secondary",children:"Sign out"})]})}),(0,t.jsxs)("section",{className:"card mt-4",children:[(0,t.jsx)(l.Toast,{message:w,onClose:()=>y(null)}),j?(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"Loading…"}):null,"bookings"===N?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"panel space-y-3",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>S("today"),className:"today"===C?"rounded-xl bg-white px-3 py-2 text-sm font-semibold":"rounded-xl bg-white/70 px-3 py-2 text-sm font-semibold",children:"By day"}),(0,t.jsx)("button",{type:"button",onClick:()=>S("range"),className:"range"===C?"rounded-xl bg-white px-3 py-2 text-sm font-semibold":"rounded-xl bg-white/70 px-3 py-2 text-sm font-semibold",children:"Date range"})]}),"today"===C?(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Date"}),(0,t.jsx)("input",{className:"input mt-1",type:"date",value:E,onChange:e=>D(e.target.value)})]}):(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"From"}),(0,t.jsx)("input",{className:"input mt-1",type:"date",value:O,onChange:e=>I(e.target.value)})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"To"}),(0,t.jsx)("input",{className:"input mt-1",type:"date",value:L,onChange:e=>T(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Status"}),(0,t.jsxs)("select",{className:"input mt-1",value:A,onChange:e=>M(e.target.value),children:[(0,t.jsx)("option",{value:"ALL",children:"All"}),(0,t.jsx)("option",{value:"BOOKED",children:"BOOKED"}),(0,t.jsx)("option",{value:"CHECKED_IN",children:"CHECKED_IN"}),(0,t.jsx)("option",{value:"IN_SERVICE",children:"IN_SERVICE"}),(0,t.jsx)("option",{value:"COMPLETED",children:"COMPLETED"}),(0,t.jsx)("option",{value:"HOLD",children:"HOLD"}),(0,t.jsx)("option",{value:"CANCELLED",children:"CANCELLED"}),(0,t.jsx)("option",{value:"EXPIRED",children:"EXPIRED"}),(0,t.jsx)("option",{value:"NO_SHOW",children:"NO_SHOW"})]})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Search (name/phone)"}),(0,t.jsx)("input",{className:"input mt-1",value:R,onChange:e=>H(e.target.value),placeholder:"e.g. Rahul / 98..."})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let e=await eh();if(!e)return v(!1);await e_(e)},children:"Refresh"}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let e=await eh();if(!e)return v(!1);await eg(e),await e_(e)},children:"Run maintenance"})]})]}),j||0!==P.length?null:(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"No bookings found."}),(0,t.jsx)("div",{className:"space-y-3",children:P.map(e=>{let a=function(e){switch(e){case"BOOKED":return{label:"BOOKED",cls:"bg-amber-50 text-amber-800 border-amber-200"};case"CHECKED_IN":return{label:"CHECKED IN",cls:"bg-emerald-50 text-emerald-800 border-emerald-200"};case"IN_SERVICE":return{label:"IN SERVICE",cls:"bg-sky-50 text-sky-800 border-sky-200"};case"COMPLETED":return{label:"COMPLETED",cls:"bg-zinc-100 text-zinc-700 border-zinc-200"};case"EXPIRED":case"NO_SHOW":return{label:e,cls:"bg-red-50 text-red-800 border-red-200"};case"CANCELLED":return{label:"CANCELLED",cls:"bg-zinc-50 text-zinc-600 border-zinc-200"};case"HOLD":return{label:"HOLD",cls:"bg-violet-50 text-violet-800 border-violet-200"};default:return{label:e,cls:"bg-zinc-50 text-zinc-700 border-zinc-200"}}}(e.status);return(0,t.jsxs)("div",{className:"rounded-2xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-lg font-semibold",children:[c(e.start_time),"–",c(e.end_time)]}),(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--text))]",children:e.customer_name}),e.customer_phone?(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:e.customer_phone}):null]}),(0,t.jsx)("div",{className:`rounded-full border px-2 py-1 text-xs font-semibold ${a.cls}`,children:a.label})]}),(0,t.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>ep(e.id,"CHECKED_IN"),className:"btn-secondary",children:"Check in"}),(0,t.jsx)("button",{type:"button",onClick:()=>ep(e.id,"IN_SERVICE"),className:"btn-secondary",children:"Start service"}),(0,t.jsx)("button",{type:"button",onClick:()=>ep(e.id,"COMPLETED"),className:"btn-secondary",children:"Completed"}),(0,t.jsx)("button",{type:"button",onClick:()=>ep(e.id,"NO_SHOW"),className:"btn-secondary",children:"No show"}),(0,t.jsx)("button",{type:"button",onClick:()=>ep(e.id,"CANCELLED"),className:"btn-secondary col-span-2",children:"Cancel booking"})]})]},e.id)})})]}):null,"queue"===N?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"panel space-y-3",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Date"}),(0,t.jsx)("input",{className:"input mt-1",type:"date",value:B,onChange:e=>W(e.target.value)})]}),(0,t.jsxs)("label",{className:" text-white flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:K,onChange:e=>q(e.target.checked)}),"Show only active (WAITING / PROMOTED)"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let e=await eh();if(!e)return v(!1);await ef(e)},children:"Refresh"}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let e=await eh();if(!e)return v(!1);await eg(e),await ef(e)},children:"Run maintenance"})]})]}),j||0!==F.length?null:(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"No waitlist entries."}),(0,t.jsx)("div",{className:"space-y-3",children:Object.entries(F.reduce((e,t)=>(e[t.slot_start_time]=e[t.slot_start_time]??[],e[t.slot_start_time].push(t),e),{})).map(([e,a])=>(0,t.jsxs)("div",{className:"rounded-2xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"Slot"}),(0,t.jsx)("div",{className:"text-lg font-semibold",children:new Date(e).toLocaleString([],{weekday:"short",hour:"numeric",minute:"2-digit"})})]}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let t=await eh();if(!t)return v(!1);await eN(t,e)},children:"Promote next"})]}),(0,t.jsx)("div",{className:"mt-3 space-y-2",children:a.map(e=>(0,t.jsx)("div",{className:"rounded-xl border border-[rgb(var(--border))] p-3",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:e.customer_name}),(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:e.customer_phone}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-[rgb(var(--muted))]",children:[e.total_duration_minutes," min · ₹",e.total_price_rupees]}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-[rgb(var(--muted))]",children:["Status: ",e.status]}),e.promotion_expires_at?(0,t.jsxs)("div",{className:"mt-1 text-xs text-[rgb(var(--muted))]",children:["Expires: ",new Date(e.promotion_expires_at).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})]}):null]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let t=await eh();if(!t)return v(!1);await ew(t,e.id)},children:"Cancel"})})]})},e.id))})]},e))})]}):null,"slots"===N?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"panel space-y-3",children:[(0,t.jsx)("div",{className:"text-sm text-white font-semibold",children:"Quick actions"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)("button",{type:"button",className:"btn-secondary",disabled:en,onClick:async()=>{let e=await eh();if(!e)return v(!1);await eD(e)},children:en?"Working…":"Close today"}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",disabled:en,onClick:async()=>{let e=await eh();if(!e)return v(!1);await eO(e)},children:en?"Working…":"Open today"})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Weekly schedule"}),(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:"This controls which slots can be generated."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[0===J.length?(0,t.jsx)("button",{type:"button",className:"btn-secondary",disabled:$,onClick:async()=>{let e=await eh();if(!e)return v(!1);await ej(e)},children:$?"Working…":"Initialize default schedule"}):null,(0,t.jsx)("button",{type:"button",className:"btn-secondary",disabled:$,onClick:async()=>{let e=await eh();if(!e)return v(!1);await ek(e)},children:$?"Saving…":"Save"})]})]}),0===J.length?(0,t.jsx)("div",{className:"alert-warning mt-3",children:"No weekly schedule found in the database. Slots cannot be generated until you initialize the schedule."}):null,(0,t.jsx)("div",{className:"mt-3 space-y-2",children:J.map(e=>(0,t.jsxs)("div",{className:"rounded-xl border border-[rgb(var(--border))] p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("div",{className:"font-semibold",children:x[e.day_of_week]??e.day_of_week}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.is_day_off,onChange:t=>V(a=>a.map(a=>a.day_of_week===e.day_of_week?{...a,is_day_off:t.target.checked}:a))}),"Day off"]})]}),(0,t.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Work start"}),(0,t.jsx)("input",{className:"input mt-1",type:"time",value:e.work_start.slice(0,5),onChange:t=>V(a=>a.map(a=>a.day_of_week===e.day_of_week?{...a,work_start:t.target.value}:a))})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Work end"}),(0,t.jsx)("input",{className:"input mt-1",type:"time",value:e.work_end.slice(0,5),onChange:t=>V(a=>a.map(a=>a.day_of_week===e.day_of_week?{...a,work_end:t.target.value}:a))})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Break start"}),(0,t.jsx)("input",{className:"input mt-1",type:"time",value:(e.break_start??"").slice(0,5),onChange:t=>V(a=>a.map(a=>a.day_of_week===e.day_of_week?{...a,break_start:t.target.value||null}:a))})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Break end"}),(0,t.jsx)("input",{className:"input mt-1",type:"time",value:(e.break_end??"").slice(0,5),onChange:t=>V(a=>a.map(a=>a.day_of_week===e.day_of_week?{...a,break_end:t.target.value||null}:a))})]})]})]},e.day_of_week))})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Blocked slots"}),(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:"Use this to disable slots for a specific time range."})]}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let e=await eh();if(!e)return v(!1);await eC(e)},children:"Refresh"})]}),(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Date"}),(0,t.jsx)("input",{className:"input mt-1",type:"date",value:X,onChange:async e=>{G(e.target.value);let t=await eh();if(!t)return v(!1);setTimeout(()=>eC(t),0)}})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Start"}),(0,t.jsx)("input",{className:"input mt-1",type:"time",value:ee,onChange:e=>et(e.target.value)})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"End"}),(0,t.jsx)("input",{className:"input mt-1",type:"time",value:ea,onChange:e=>es(e.target.value)})]})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"label",children:"Reason (optional)"}),(0,t.jsx)("input",{className:"input mt-1",value:er,onChange:e=>ei(e.target.value),placeholder:"e.g. Lunch / Personal / CLOSED_TODAY"})]}),(0,t.jsx)("button",{type:"button",className:"btn-primary",disabled:en,onClick:async()=>{let e=await eh();if(!e)return v(!1);await eS(e)},children:en?"Saving…":"Add block (disable slots)"}),(0,t.jsxs)("div",{className:"space-y-2",children:[Z.map(e=>(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-xl border border-[rgb(var(--border))] p-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-semibold",children:[c(e.start_time),"–",c(e.end_time)]}),e.reason?(0,t.jsx)("div",{className:"text-xs text-[rgb(var(--muted))]",children:e.reason}):null]}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",onClick:async()=>{let t=await eh();if(!t)return v(!1);await eE(t,e.id)},children:"Remove"})]},e.id)),j||0!==Z.length?null:(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"No blocks for this date."})]})]})]})]}):null,"services"===N?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"panel space-y-3",children:[(0,t.jsx)("div",{className:"text-sm text-white font-semibold",children:"Add service"}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Name"}),(0,t.jsx)("input",{className:"input mt-1",value:em.name,onChange:e=>eb(t=>({...t,name:e.target.value}))})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Price (₹)"}),(0,t.jsx)("input",{className:"input mt-1",inputMode:"numeric",value:em.price,onChange:e=>eb(t=>({...t,price:e.target.value}))})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("div",{className:"text-white",children:"Duration (min)"}),(0,t.jsx)("input",{className:"input mt-1",inputMode:"numeric",value:em.duration,onChange:e=>eb(t=>({...t,duration:e.target.value}))})]})]}),(0,t.jsx)("button",{type:"button",className:"btn-primary",disabled:"NEW"===eo,onClick:async()=>{let e=await eh();if(!e)return v(!1);await eT(e)},children:"NEW"===eo?"Adding…":"Add service"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[ec.map(e=>(0,t.jsx)("div",{className:"rounded-2xl border border-[rgb(var(--border))] bg-[rgb(var(--card))] p-3",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:e.name}),(0,t.jsxs)("div",{className:"text-xs text-[rgb(var(--muted))]",children:["₹",e.price_rupees," · ",e.duration_minutes," min"]}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-[rgb(var(--muted))]",children:["Active: ",e.is_active?"Yes":"No"]})]}),(0,t.jsx)("button",{type:"button",className:"btn-secondary",disabled:eo===e.id,onClick:async()=>{let t=await eh();if(!t)return v(!1);await eL(t,e)},children:eo===e.id?"Saving…":e.is_active?"Disable":"Enable"})]})},e.id)),j||0!==ec.length?null:(0,t.jsx)("div",{className:"text-sm text-[rgb(var(--muted))]",children:"No services yet."})]})]}):null]})]})})}function p(){let e,r=(0,a.c)(1);return r[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen px-4 py-5",children:(0,t.jsx)("div",{className:"mx-auto w-full max-w-lg",children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-[rgb(var(--muted))]",children:"Barber Dashboard"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-[rgb(var(--muted))]",children:"Loading…"})]})})}),children:(0,t.jsx)(_,{})}),r[0]=e):e=r[0],e}e.s(["default",()=>p])}]);